<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Mongolite User Manual</title>
  <meta name="description" content="A brief introduction to MongoDB and mongolite for R users">
  <meta name="generator" content="bookdown 0.5.10 and GitBook 2.6.7">

  <meta property="og:title" content="Mongolite User Manual" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A brief introduction to MongoDB and mongolite for R users" />
  <meta name="github-repo" content="jeroen/mongolite" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Mongolite User Manual" />
  
  <meta name="twitter:description" content="A brief introduction to MongoDB and mongolite for R users" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="query-data.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mongolite User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements-linux-mac"><i class="fa fa-check"></i><b>1.1</b> Requirements (Linux / Mac)</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#install-mongolite-in-r"><i class="fa fa-check"></i><b>1.2</b> Install mongolite in R</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#run-local-mongod"><i class="fa fa-check"></i><b>1.3</b> Run local mongod</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#testing-with-ssl"><i class="fa fa-check"></i><b>1.4</b> Testing with SSL</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html"><i class="fa fa-check"></i><b>2</b> Connecting to MongoDB</a><ul>
<li class="chapter" data-level="2.1" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#mongo-uri-format"><i class="fa fa-check"></i><b>2.1</b> Mongo URI Format</a><ul>
<li class="chapter" data-level="2.1.1" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#dns-seedlist-connection-format"><i class="fa fa-check"></i><b>2.1.1</b> DNS Seedlist Connection Format</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#authentication"><i class="fa fa-check"></i><b>2.2</b> Authentication</a><ul>
<li class="chapter" data-level="2.2.1" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#ldap"><i class="fa fa-check"></i><b>2.2.1</b> LDAP</a></li>
<li class="chapter" data-level="2.2.2" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#x509"><i class="fa fa-check"></i><b>2.2.2</b> X509</a></li>
<li class="chapter" data-level="2.2.3" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#kerberos"><i class="fa fa-check"></i><b>2.2.3</b> Kerberos</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#ssh-tunnel"><i class="fa fa-check"></i><b>2.3</b> SSH Tunnel</a></li>
<li class="chapter" data-level="2.4" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#ssl-options"><i class="fa fa-check"></i><b>2.4</b> SSL options</a></li>
<li class="chapter" data-level="2.5" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#replica-options"><i class="fa fa-check"></i><b>2.5</b> Replica Options</a><ul>
<li class="chapter" data-level="2.5.1" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#read-preference"><i class="fa fa-check"></i><b>2.5.1</b> Read Preference</a></li>
<li class="chapter" data-level="2.5.2" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#write-concern"><i class="fa fa-check"></i><b>2.5.2</b> Write Concern</a></li>
<li class="chapter" data-level="2.5.3" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#read-concern"><i class="fa fa-check"></i><b>2.5.3</b> Read Concern</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="connecting-to-mongodb.html"><a href="connecting-to-mongodb.html#global-options"><i class="fa fa-check"></i><b>2.6</b> Global options</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="query-data.html"><a href="query-data.html"><i class="fa fa-check"></i><b>3</b> Query Data</a><ul>
<li class="chapter" data-level="3.1" data-path="query-data.html"><a href="query-data.html#query-syntax"><i class="fa fa-check"></i><b>3.1</b> Query syntax</a></li>
<li class="chapter" data-level="3.2" data-path="query-data.html"><a href="query-data.html#filter-fields"><i class="fa fa-check"></i><b>3.2</b> Filter fields</a></li>
<li class="chapter" data-level="3.3" data-path="query-data.html"><a href="query-data.html#sort-and-limit"><i class="fa fa-check"></i><b>3.3</b> Sort and limit</a></li>
<li class="chapter" data-level="3.4" data-path="query-data.html"><a href="query-data.html#indexing"><i class="fa fa-check"></i><b>3.4</b> Indexing</a></li>
<li class="chapter" data-level="3.5" data-path="query-data.html"><a href="query-data.html#iterating"><i class="fa fa-check"></i><b>3.5</b> Iterating</a></li>
<li class="chapter" data-level="3.6" data-path="query-data.html"><a href="query-data.html#select-by-date"><i class="fa fa-check"></i><b>3.6</b> Select by date</a></li>
<li class="chapter" data-level="3.7" data-path="query-data.html"><a href="query-data.html#select-by-id"><i class="fa fa-check"></i><b>3.7</b> Select by ID</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manipulate-data.html"><a href="manipulate-data.html"><i class="fa fa-check"></i><b>4</b> Manipulate Data</a><ul>
<li class="chapter" data-level="4.1" data-path="manipulate-data.html"><a href="manipulate-data.html#insert"><i class="fa fa-check"></i><b>4.1</b> Insert</a></li>
<li class="chapter" data-level="4.2" data-path="manipulate-data.html"><a href="manipulate-data.html#remove"><i class="fa fa-check"></i><b>4.2</b> Remove</a></li>
<li class="chapter" data-level="4.3" data-path="manipulate-data.html"><a href="manipulate-data.html#update-upsert"><i class="fa fa-check"></i><b>4.3</b> Update / Upsert</a></li>
<li class="chapter" data-level="4.4" data-path="manipulate-data.html"><a href="manipulate-data.html#array-filters"><i class="fa fa-check"></i><b>4.4</b> Array Filters</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="import-export.html"><a href="import-export.html"><i class="fa fa-check"></i><b>5</b> Import / Export</a><ul>
<li class="chapter" data-level="5.1" data-path="import-export.html"><a href="import-export.html#json"><i class="fa fa-check"></i><b>5.1</b> JSON</a></li>
<li class="chapter" data-level="5.2" data-path="import-export.html"><a href="import-export.html#via-jsonlite"><i class="fa fa-check"></i><b>5.2</b> Via jsonlite</a></li>
<li class="chapter" data-level="5.3" data-path="import-export.html"><a href="import-export.html#streaming"><i class="fa fa-check"></i><b>5.3</b> Streaming</a></li>
<li class="chapter" data-level="5.4" data-path="import-export.html"><a href="import-export.html#bson"><i class="fa fa-check"></i><b>5.4</b> BSON</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="calculation.html"><a href="calculation.html"><i class="fa fa-check"></i><b>6</b> Calculation</a><ul>
<li class="chapter" data-level="6.1" data-path="calculation.html"><a href="calculation.html#aggregate"><i class="fa fa-check"></i><b>6.1</b> Aggregate</a></li>
<li class="chapter" data-level="6.2" data-path="calculation.html"><a href="calculation.html#mapreduce"><i class="fa fa-check"></i><b>6.2</b> Map/Reduce</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/jeroen/mongolite/edit/gh-pages/mongobook" target="blank">(c) Jeroen Ooms, 2017</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mongolite User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="connecting-to-mongodb" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Connecting to MongoDB</h1>
<div id="mongo-uri-format" class="section level2">
<h2><span class="header-section-number">2.1</span> Mongo URI Format</h2>
<p>The <code>mongo()</code> function initiates a connection object to a MongoDB server. For example:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">library</span>(mongolite)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="st">&quot;mtcars&quot;</span>, <span class="dt">url =</span> <span class="st">&quot;mongodb://readwrite:test@ds043942.mongolab.com:43942/jeroen_test&quot;</span>)</a></code></pre></div>
<p>To get an overview of available methods, simply print the object to the terminal.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">print</span>(m)</a></code></pre></div>
<pre class="outputcode"><code>#&gt; &lt;Mongo collection&gt; &#39;mtcars&#39; 
#&gt;  $aggregate(pipeline = &quot;{}&quot;, options = &quot;{\&quot;allowDiskUse\&quot;:true}&quot;, handler = NULL, pagesize = 1000) 
#&gt;  $count(query = &quot;{}&quot;) 
#&gt;  $distinct(key, query = &quot;{}&quot;) 
#&gt;  $drop() 
#&gt;  $export(con = stdout(), bson = FALSE) 
#&gt;  $find(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0, handler = NULL, pagesize = 1000) 
#&gt;  $import(con, bson = FALSE) 
#&gt;  $index(add = NULL, remove = NULL) 
#&gt;  $info() 
#&gt;  $insert(data, pagesize = 1000, stop_on_error = TRUE, ...) 
#&gt;  $iterate(query = &quot;{}&quot;, fields = &quot;{\&quot;_id\&quot;:0}&quot;, sort = &quot;{}&quot;, skip = 0, limit = 0) 
#&gt;  $mapreduce(map, reduce, query = &quot;{}&quot;, sort = &quot;{}&quot;, limit = 0, out = NULL, scope = NULL) 
#&gt;  $remove(query, just_one = FALSE) 
#&gt;  $rename(name, db = NULL) 
#&gt;  $update(query, update = &quot;{\&quot;$set\&quot;:{}}&quot;, filters = &quot;[]&quot;, upsert = FALSE, multiple = FALSE)</code></pre>
<p>The R manual page for the <code>mongo()</code> function gives some brief descriptions as well.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">?mongo</a></code></pre></div>
<p>The manual page tells us that <code>mongo()</code> supports the following arguments:</p>
<ul>
<li><code>collection</code>: name of the collection to connect to. Defaults to <code>&quot;test&quot;</code>.</li>
<li><code>db</code>: name of the database to connect to. Defaults to <code>&quot;test&quot;</code>.</li>
<li><code>url</code>: address of the MongoDB server in standard <a href="https://docs.mongodb.com/manual/reference/connection-string/">URI Format</a>.</li>
<li><code>verbose</code>: if <code>TRUE</code>, emits some extra output</li>
<li><code>options</code>: additional connection options such as SSL keys/certs.</li>
</ul>
<p>The <code>url</code> parameter contains a special URI format which defines the server address and additional connection options.</p>
<pre><code>mongodb://[username:password@]host1[:port1][,host2[:port2],...[/[database][?options]]</code></pre>
<p>The <a href="https://docs.mongodb.com/manual/reference/connection-string/">Mongo Connection String Manual</a> gives an overview of the connection string syntax and options. Below the most important options for using mongolite.</p>
<div id="dns-seedlist-connection-format" class="section level3">
<h3><span class="header-section-number">2.1.1</span> DNS Seedlist Connection Format</h3>
<p>New in <code>mongolite 1.3</code> is support for <a href="https://docs.mongodb.com/manual/reference/connection-string/#dns-seedlist-connection-format">seedlist</a> URLs with the <code>mongodb+srv://</code> prefix. This indicates that before connecting, the client should lookup the actual host addresses and parameters from the DNS <a href="https://en.wikipedia.org/wiki/SRV_record">SRV</a> or <a href="https://en.wikipedia.org/wiki/TXT_record">TXT</a> record.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="st">&quot;mtcars&quot;</span>, <span class="dt">url =</span> <span class="st">&quot;mongodb+srv://readwrite:test@cluster0-84vdt.mongodb.net/test&quot;</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">con<span class="op">$</span><span class="kw">insert</span>(mtcars)</a></code></pre></div>
<pre class="outputcode"><code>#&gt; List of 5
#&gt;  $ nInserted  : num 32
#&gt;  $ nMatched   : num 0
#&gt;  $ nRemoved   : num 0
#&gt;  $ nUpserted  : num 0
#&gt;  $ writeErrors: list()</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">con<span class="op">$</span><span class="kw">drop</span>()</a></code></pre></div>
<p>The DNS seedlist allows for using a short and fixed URL for clusters consisting of multiple or dynamic servers and parameters.</p>
</div>
</div>
<div id="authentication" class="section level2">
<h2><span class="header-section-number">2.2</span> Authentication</h2>
<p>MongoDB supports several authentication modes.</p>
<div id="ldap" class="section level3">
<h3><span class="header-section-number">2.2.1</span> LDAP</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">USER =<span class="st"> &quot;drivers-team&quot;</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">PASS =<span class="st"> &quot;mongor0x$xgen&quot;</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">HOST =<span class="st"> &quot;ldaptest.10gen.cc&quot;</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co"># Using plain-text</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">URI =<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;mongodb://%s:%s@%s/ldap?authMechanism=PLAIN&quot;</span>, USER, PASS, HOST)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> URI)</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">m<span class="op">$</span><span class="kw">find</span>()</a></code></pre></div>
<p>However it is recommended to use SSL instead of plain text when authenticating with a username/password:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Or over SSL</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> <span class="kw">paste0</span>(URI, <span class="st">&quot;&amp;ssl=true&quot;</span>), <span class="dt">options =</span> </a>
<a class="sourceLine" id="cb20-3" data-line-number="3">             <span class="kw">ssl_options</span>(<span class="dt">ca =</span> <span class="st">&quot;auth/ca.crt&quot;</span>, <span class="dt">allow_invalid_hostname =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">m<span class="op">$</span><span class="kw">find</span>()</a></code></pre></div>
</div>
<div id="x509" class="section level3">
<h3><span class="header-section-number">2.2.2</span> X509</h3>
<p>Let’s check if our server supports SSL:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">certs &lt;-<span class="st"> </span>openssl<span class="op">::</span><span class="kw">download_ssl_cert</span>(<span class="st">&#39;ldaptest.10gen.cc&#39;</span>, <span class="dv">27017</span>)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="kw">print</span>(certs)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw">str</span>(<span class="kw">as.list</span>(certs[[<span class="dv">1</span>]]))</a></code></pre></div>
<p>To use X509 authentication the Mongo URI needs <code>ssl=true&amp;authMechanism=MONGODB-X509</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># Using X509 SSL auth</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">HOST &lt;-<span class="st"> &quot;ldaptest.10gen.cc&quot;</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">USER &lt;-<span class="st"> &quot;CN=client,OU=kerneluser,O=10Gen,L=New York City,ST=New York,C=US&quot;</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">URI &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;mongodb://%s@%s/x509?ssl=true&amp;authMechanism=MONGODB-X509&quot;</span>, USER, HOST)</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">OPTS &lt;-<span class="st"> </span><span class="kw">ssl_options</span>(<span class="dt">cert =</span> <span class="st">&quot;auth/client.pem&quot;</span>, <span class="dt">key =</span> <span class="st">&quot;auth/key.pem&quot;</span>, <span class="dt">ca =</span> <span class="st">&quot;auth/ca.crt&quot;</span>, <span class="dt">allow_invalid_hostname =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> URI, <span class="dt">options =</span> OPTS)</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">m<span class="op">$</span><span class="kw">find</span>()</a></code></pre></div>
</div>
<div id="kerberos" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Kerberos</h3>
<p><em><strong>Note</strong>: Windows uses <code>SSPI</code> for Kerberos authentication. This section does not apply</em>.</p>
<p>Kerberos authentication on Linux requires installation of a Kerberos client. On OS-X Kerberos is already installed by default. On Ubuntu/Debian we need:</p>
<pre><code>sudo apt-get install krb5-user libsasl2-modules-gssapi-mit</code></pre>
<p>Next, create or edit <code>/etc/krbs5.conf</code> and add our server under <code>[realms]</code> for example:</p>
<pre><code>[realms]
  LDAPTEST.10GEN.CC = {
    kdc = ldaptest.10gen.cc
    admin_server = ldaptest.10gen.cc
  }</code></pre>
<p>In a terminal run the following (only have to do this once)</p>
<pre><code>kinit drivers@LDAPTEST.10GEN.CC
klist</code></pre>
<p>We should now be able to connect in R:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">HOST &lt;-<span class="st"> &quot;ldaptest.10gen.cc&quot;</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">USER &lt;-<span class="st"> &quot;drivers%40LDAPTEST.10GEN.CC&quot;</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3">URI &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;mongodb://%s@%s/kerberos?authMechanism=GSSAPI&quot;</span>, USER, HOST)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> URI)</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">m<span class="op">$</span><span class="kw">find</span>()</a></code></pre></div>
</div>
</div>
<div id="ssh-tunnel" class="section level2">
<h2><span class="header-section-number">2.3</span> SSH Tunnel</h2>
<p>To connect to MongoDB via an SSH tunnel, you need to setup the tunnel separately with an SSH client. For example the mongolite manual contains this example:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="st">&quot;mtcars&quot;</span>, <span class="dt">url =</span> <span class="st">&quot;mongodb://readwrite:test@ds043942.mongolab.com:43942/jeroen_test&quot;</span>)</a></code></pre></div>
<p>Assume we want to tunnel through <code>dev.opencpu.org</code> which runs an SSH server on the standard port 22 with username <code>jeroen</code>. To initiate a tunnel from <code>localhost:9999</code> to <code>ds043942.mongolab.com:43942</code> via the ssh server <code>dev.opencpu.org:22</code>, open a terminal and run:</p>
<pre><code>ssh -L 9999:ds043942.mongolab.com:43942 jeroen@dev.opencpu.org -vN -p22</code></pre>
<p>Some relevant <code>ssh</code> flags:</p>
<ul>
<li><code>-v</code> (optional) show verbose status output</li>
<li><code>-f</code> run the tunnel server in the background. Use <code>pkill ssh</code> to kill.</li>
<li><code>-p22</code> connect to ssh server on port 22 (default)</li>
<li><code>-i/some/path/id_rsa</code> authenticate with ssh using a private key</li>
</ul>
<p>Check <code>man ssh</code> for more ssh options It is also possible to run this command directly from R:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">system</span>(<span class="st">&quot;ssh -L 9999:ds043942.mongolab.com:43942 jeroen@dev.opencpu.org -fN -p22&quot;</span>)</a></code></pre></div>
<p>Once tunnel has been established, we can connect to our our ssh client which will tunnel traffic to our MongoDB server. In our example we run the ssh client on our localhost port 9999:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="st">&quot;mtcars&quot;</span>, <span class="dt">url =</span> <span class="st">&quot;mongodb://readwrite:test@localhost:9999/jeroen_test&quot;</span>)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">con<span class="op">$</span><span class="kw">insert</span>(mtcars)</a></code></pre></div>
<pre class="outputcode"><code>#&gt; List of 5
#&gt;  $ nInserted  : num 32
#&gt;  $ nMatched   : num 0
#&gt;  $ nRemoved   : num 0
#&gt;  $ nUpserted  : num 0
#&gt;  $ writeErrors: list()</code></pre>
<p>If you want to setup a tunnel client on Windows and you do not have the <code>ssh</code> program, you can an SSH client like putty to setup the tunnel. See <a href="http://realprogrammers.com/how_to/set_up_an_ssh_tunnel_with_putty.html">this example</a>.</p>
</div>
<div id="ssl-options" class="section level2">
<h2><span class="header-section-number">2.4</span> SSL options</h2>
<p>For security reasons, SSL options can not be configured in the URI but have to be set manually via the <code>options</code> parameter. The <code>ssl_options</code> function shows the default values:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">ssl_options</span>()</a></code></pre></div>
<pre class="outputcode"><code>#&gt; List of 6
#&gt;  $ pem_file              : NULL
#&gt;  $ ca_file               : NULL
#&gt;  $ ca_dir                : NULL
#&gt;  $ crl_file              : NULL
#&gt;  $ allow_invalid_hostname: logi FALSE
#&gt;  $ weak_cert_validation  : logi FALSE</code></pre>
<p>You can use this function to specify connection SSL options:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> <span class="st">&quot;mongodb://localhost?ssl=true&quot;</span>, </a>
<a class="sourceLine" id="cb34-2" data-line-number="2">  <span class="dt">options =</span> <span class="kw">ssl_options</span>(<span class="dt">cert =</span> <span class="st">&quot;~/client.crt&quot;</span>, <span class="dt">key =</span> <span class="st">&quot;~/id_rsa.pem&quot;</span>))</a></code></pre></div>
<p>The MongoDB <a href="https://docs.mongodb.com/manual/tutorial/configure-ssl-clients/">SSL client manual</a> has more detailed descriptions on the various options.</p>
</div>
<div id="replica-options" class="section level2">
<h2><span class="header-section-number">2.5</span> Replica Options</h2>
<p>The URI accepts a few special keys when connecting to a replicaset. The <a href="https://docs.mongodb.com/manual/reference/connection-string/">connection-string manual</a> is the canonical source for all parameters. Most users should stick with the defaults here, only specify these if you know what you are doing.</p>
<div id="read-preference" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Read Preference</h3>
<p>The <strong>Read Preference</strong> paremeter specifies if the client should connect to the primary node (default) or a secondary node in the replica set.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> <span class="st">&quot;mongodb://host.example.com/?readPreference=secondary&quot;</span>)</a></code></pre></div>
</div>
<div id="write-concern" class="section level3">
<h3><span class="header-section-number">2.5.2</span> Write Concern</h3>
<p>The <strong>Write Concern</strong> parameter is used to specify the level of acknowledgement that the write operation has propagated to a number of server nodes. The url string parameter is the letter <code>w</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> <span class="st">&quot;mongodb://host.example.com/?w=2&quot;</span>)</a></code></pre></div>
<p>Note that specifying this parameter to 2 on a server that is not a replicaset will result in an error when trying to write:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> <span class="st">&quot;mongodb://localhost/?w=2&quot;</span>)</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">m<span class="op">$</span><span class="kw">insert</span>(<span class="st">&#39;{&quot;foo&quot; : &quot;bar&quot;}&#39;</span>)</a></code></pre></div>
<pre class="outputcode"><code>#&gt; Error: cannot use &#39;w&#39; &gt; 1 when a host is not replicated</code></pre>
</div>
<div id="read-concern" class="section level3">
<h3><span class="header-section-number">2.5.3</span> Read Concern</h3>
<p>Finally, <strong>Read Concern</strong> allows clients to choose a level of isolation for their reads from replica sets. The default value <code>local</code> returns the instance’s most recent data, but provides no guarantee that the data has been written to a majority of the replica set members (i.e. may be rolled back).</p>
<p>On the other hand, if we specify <code>majority</code> the server will only return data that has been propagated to the majority of nodes.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> <span class="st">&quot;mongodb://localhost/?readConcernLevel=majority&quot;</span>)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">m<span class="op">$</span><span class="kw">insert</span>(<span class="st">&#39;{&quot;foo&quot;: 123}&#39;</span>)</a></code></pre></div>
<pre class="outputcode"><code>#&gt; List of 6
#&gt;  $ nInserted  : int 1
#&gt;  $ nMatched   : int 0
#&gt;  $ nModified  : int 0
#&gt;  $ nRemoved   : int 0
#&gt;  $ nUpserted  : int 0
#&gt;  $ writeErrors: list()</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">m<span class="op">$</span><span class="kw">insert</span>(<span class="st">&#39;{&quot;foo&quot;: 456}&#39;</span>)</a></code></pre></div>
<pre class="outputcode"><code>#&gt; List of 6
#&gt;  $ nInserted  : int 1
#&gt;  $ nMatched   : int 0
#&gt;  $ nModified  : int 0
#&gt;  $ nRemoved   : int 0
#&gt;  $ nUpserted  : int 0
#&gt;  $ writeErrors: list()</code></pre>
<p>In the case of our local single-node server this is never the case. Therefore we see that the server does not return any data that meets the majority level.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">m<span class="op">$</span><span class="kw">count</span>()</a></code></pre></div>
<pre class="outputcode"><code>#&gt; [1] 2</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">m<span class="op">$</span><span class="kw">find</span>()</a></code></pre></div>
<pre class="outputcode"><code>#&gt;   foo
#&gt; 1 123
#&gt; 2 456</code></pre>
<p>The data is definitely there though, it just doesn’t meet the <code>majority</code> criterium. If we create a new connection with level <code>local</code> we do get to see our data:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">m2 &lt;-<span class="st"> </span><span class="kw">mongo</span>(<span class="dt">url =</span> <span class="st">&quot;mongodb://localhost/?readConcernLevel=local&quot;</span>)</a>
<a class="sourceLine" id="cb47-2" data-line-number="2">m2<span class="op">$</span><span class="kw">count</span>()</a></code></pre></div>
<pre class="outputcode"><code>#&gt; [1] 2</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">m2<span class="op">$</span><span class="kw">find</span>()</a></code></pre></div>
<pre class="outputcode"><code>#&gt;   foo
#&gt; 1 123
#&gt; 2 456</code></pre>
</div>
</div>
<div id="global-options" class="section level2">
<h2><span class="header-section-number">2.6</span> Global options</h2>
<p>Finally the <code>mongo_options</code> method allows for setting global client options that span across connections. Currently two options are supported:</p>
<ul>
<li><code>log_level</code> set the mongo <a href="http://mongoc.org/libmongoc/current/logging.html">log level</a>, e.g. for printing debugging information.</li>
<li><code>bigint_as_char</code> set to <code>TRUE</code> to parse int64 numbers as strings rather than doubles (R does not support large integers natively)</li>
</ul>
<p>The default values are:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">mongo_options</span>()</a></code></pre></div>
<pre class="outputcode"><code>#&gt; $log_level
#&gt; [1] &quot;INFO&quot;
#&gt; 
#&gt; $bigint_as_char
#&gt; [1] FALSE
#&gt; 
#&gt; $date_as_char
#&gt; [1] FALSE</code></pre>
<p>See the manual page for <code>?mongo_options</code> for more details.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="query-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jeroen/mongolite/edit/gh-pages/mongobook01-connecting.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
